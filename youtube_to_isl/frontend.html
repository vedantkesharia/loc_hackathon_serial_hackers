<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Speech Recognition with AI Response</title>
<link rel="stylesheet" href="frontend.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script src="../static/js/colors.js" defer></script>
<script src="./frontend.js" ></script>
<script>
  // Define different color themes
const colorThemes = {
    theme1: {
        bodyBackground: '#9FB6E2',
        buttonBackground: '#f1bb83',
        buttonBorder: '#800080',
        outputBorder: '#000000',
        outputBackground: '#f1bb83',
        outputText: '#000000',
        actionBorder: '#000000',
        actionBackground: '#f1bb83',
        actionText: '#000000'
    },
    theme2: {
        bodyBackground: '#905971',
        buttonBackground: '#E09ADA',
        buttonBorder: '#000000',
        outputBorder: '#000000',
        outputBackground: '#E0D09C',
        outputText: '#000000',
        actionBorder: '#000000',
        actionBackground: '#E0D09C',
        actionText: '#000000'
    },
    theme3: {
        bodyBackground: '#905971',
        buttonBackground: '#905971',
        buttonBorder: '#ffffff',
        outputBorder: '#000000',
        outputBackground: '#F9D372',
        outputText: '#000000',
        actionBorder: '#000000',
        actionBackground: '#F9D372',
        actionText: '#000000'
    }
};

// Function to apply the selected color theme
function applyColorTheme(theme) {
    console.log('Applying color theme:', theme);
    const colors = colorThemes[theme];
    // document.body.style.backgroundColor = colors.bodyBackground;
    document.querySelectorAll('.mic-btn button').forEach(btn => {
        btn.style.backgroundColor = colors.buttonBackground;
        btn.style.borderColor = colors.buttonBorder;
    });
    document.getElementById('output').style.borderColor = colors.outputBorder;
    document.getElementById('output').style.backgroundColor = colors.outputBackground;
    document.getElementById('output').style.color = colors.outputText;
    document.getElementById('action').style.borderColor = colors.actionBorder;
    document.getElementById('action').style.backgroundColor = colors.actionBackground;
    document.getElementById('action').style.color = colors.actionText;
    // document.getElementById('mic-btn').style.color = colors.bodyBackground;
}

</script>
</head>
<body>

<div class="lang">
  <div class="language">
  <span class="lang-text">Please Select A Language: </span>
  <span class="lang-dropdown">
<select id="language">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
    <option value="mr">Marathi</option>   
    <option value="gu">Gujarati</option>
    <option value="pa">Punjabi</option>
    <option value="sd">Sindhi</option>
    <option value="bn">Bengali</option>
    <option value="te">Telugu</option>
    <option value="ta">Tamil</option>
    <option value="ur">Urdu</option>
    <!-- Add more language options as needed -->
  </select>
  
  </span></div>
  <div class="color-buttons">
    <button id="theme1"  onclick="applyColorTheme('theme1')">Theme 1</button>
    <button id="theme2" onclick="applyColorTheme('theme2')">Theme 2</button>
    <button id="theme3" onclick="applyColorTheme('theme3')">Theme 3</button>
  </div>
</div>

<div class="mic-btn"><button onclick="startRecognition()"><i class="fas fa-microphone"></i></button></div>
<div id="output"></div>
<div id="action"></div>

<script>
var recognition;
var isGreetingSpoken = false; // Flag to track whether the greeting message has been spoken
var speechSpeed = 1.0; // Initial speech speed

function startRecognition() {
    var selectedLanguage = document.getElementById("language").value;
    recognition = new webkitSpeechRecognition();
    recognition.lang = selectedLanguage;
    recognition.continuous = false; // Prevent continuous recognition
    recognition.interimResults = false; // Turn off interim results
    recognition.onresult = function(event) {
        var transcript = event.results[0][0].transcript.trim().toLowerCase();
        document.getElementById("output").innerHTML = "<div class='search-query'><b>Spoken Text: </b>" + transcript + "</div>";

        if (isGreetingSpoken) { // Start recognizing commands only after the greeting message has been spoken
            if (transcript.includes("wikipedia") || transcript.includes("विकिपीडिया") || transcript.includes("વિકિપીડિયા") || transcript.includes("ਵਿਕੀਪੀਡੀਆ") || transcript.includes("وڪيپيڊيا") || transcript.includes("উইকিপিডিয়া") || transcript.includes("వికీపీడియా") || transcript.includes("விக்கிப்பீடியா") || transcript.includes("ویکیپیڈیا")) {
                getSearchQuery(selectedLanguage);
            } else if (transcript.includes("ask") || transcript.includes("पूछिए") || transcript.includes("विचार") || transcript.includes("પૂછો") || transcript.includes("ਪੁੱਛੋ") || transcript.includes("پڇو") || transcript.includes("জিজ্ঞাসা") || transcript.includes("అడుగు") || transcript.includes("வினவு") || transcript.includes("پوچھنا")) {
                getQuestion(selectedLanguage);
            } 
             else if (transcript.includes('help')) {
                speak("Say 'help' for help, 'Wikipedia' for getting information from Wikipedia, and 'ask' to ask anything. To increase speed, say 'increase speed'. To decrease speed, say 'decrease speed and to abort the recognition, say 'stop'.");
            } else if (transcript.includes('increase speed')) {
                speechSpeed += 2;
                speak("Speech speed increased.");
            } else if (transcript.includes('decrease speed')) {
                speechSpeed -= 2;
                speak("Speech speed decreased.");
            } else if (transcript.includes('stop')) {
                speakandstop("Execution aborted")
                recognition.abort();
            } else {
                sendVoiceToPython(transcript);
            }
        }
    };

    if (!isGreetingSpoken) { // If the greeting message hasn't been spoken yet, speak it
        // speak("Hello, I am your voice assistant. Say 'help' for help, 'Wikipedia' for getting information from Wikipedia, and 'ask' to ask anything. To increase speed, say 'increase speed'. To decrease speed, say 'decrease speed and to abort the recognition, say 'stop'.");
        speak("h")
        isGreetingSpoken = true; // Set the flag to true indicating that the greeting message has been spoken
    } else { // If the greeting message has already been spoken, start recognition directly
        recognition.start();
    }
}

function getSearchQuery(selectedLanguage) {
    recognition.stop();
    var innerRecognition = new webkitSpeechRecognition();
    innerRecognition.lang = selectedLanguage;
    innerRecognition.continuous = false;
    innerRecognition.interimResults = false;
    innerRecognition.onresult = function(event) {
        var searchQuery = event.results[0][0].transcript.trim();
        document.getElementById("output").innerHTML += "<div class='searchinig'><b>Search Query:</b> " + searchQuery + "</div>";
        sendVoiceToPythonForWikipedia(searchQuery, selectedLanguage);
    };
    document.getElementById("output").innerHTML += "<div class='instruction'><b>Say your search query for Wikipedia:</b></div>";
    innerRecognition.start();
}

function getQuestion(selectedLanguage) {
    recognition.stop();
    var innerRecognition = new webkitSpeechRecognition();
    innerRecognition.lang = selectedLanguage;
    innerRecognition.continuous = false;
    innerRecognition.interimResults = false;
    innerRecognition.onresult = function(event) {
        var question = event.results[0][0].transcript.trim();
        console.log('Transcript for "ask" command:', question); // Log the transcript
        document.getElementById("output").innerHTML += "<div class='instruction'><b>Question:</b> " + question + '</div>';
        sendVoiceToPythonForGemini(question, selectedLanguage);
    };
    document.getElementById("output").innerHTML += "<div class='searching'><b>Ask your question:</b></div>";
    innerRecognition.start();
}

function sendVoiceToPython(transcript) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://localhost:8001/gemini");
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            document.getElementById("action").innerHTML = "<div class='search-query'><b>AI Response:</b> " + response.ai_response + "</div>";
            speak(response.ai_response); // Speak the AI response
            startRecognition(); // Start recognition again after response
        }
    };
    var data = JSON.stringify({gemini: transcript, selected_language: selectedLanguage });
    xhr.send(data);
}

function sendVoiceToPythonForWikipedia(searchQuery, selectedLanguage) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://localhost:8001/wiki_summary");
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            document.getElementById("action").innerHTML = "<div class='search-query'><b>Wikipedia Summary:</b> " + response.summary + "</div>";
            // speak(response.summary); // Speak the Wikipedia summary
            translateSummary(response.summary);
            startRecognition(); // Start recognition again after response
        }
    };
    var data = JSON.stringify({"search_query": searchQuery});
    xhr.send(data);
}

function sendVoiceToPythonForGemini(question, selectedLanguage) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://localhost:8001/gemini");
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            document.getElementById("action").innerHTML = "<div class='search-query'><b>Response:</b> " + response.ai_response + "</div>";
            speak(response.ai_response); // Speak the Gemini response
            startRecognition(); // Start recognition again after response
        }
    };
    var data = JSON.stringify({ gemini: question, selected_language: selectedLanguage });
    xhr.send(data);
}

function translateSummary(summary, selectedLanguage) {
  
  // Display the translated summary
  document.getElementById("action").innerHTML = summary;
  speak(summary);
}

function speak(text) {
    var utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = speechSpeed; // Set the speech speed
    utterance.onend = function() {
        recognition.start(); // Start recognition after speaking is finished
    };
    window.speechSynthesis.speak(utterance);
}

function speakandstop(text) {
    var utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = speechSpeed; // Set the speech speed
    
    window.speechSynthesis.speak(utterance);
}

// Add this to your existing JavaScript code
// document.addEventListener('keydown', function(event) {
//     if (event.keyCode === 38) { // Up arrow key
//         changeFontSize(2); // Increase font size by 2px
//     } else if (event.keyCode === 40) { // Down arrow key
//         changeFontSize(-2); // Decrease font size by 2px
//     }
// });

// Add this to your existing JavaScript code
document.addEventListener('keydown', function(event) {
    if (event.keyCode === 38) { // Up arrow key
        changeFontSize(2); // Increase font size by 2px
    } else if (event.keyCode === 40) { // Down arrow key
        changeFontSize(-2); // Decrease font size by 2px
    }
});

function changeFontSize(changeAmount) {
    var body = document.querySelector('body');
    var currentSize = parseFloat(window.getComputedStyle(body, null).getPropertyValue('font-size'));
    var newSize = currentSize + changeAmount;
    body.style.fontSize = newSize + 'px';

    // Adjust font size of buttons
    var buttons = document.querySelectorAll('button');
    buttons.forEach(function(button) {
        var currentButtonSize = parseFloat(window.getComputedStyle(button, null).getPropertyValue('font-size'));
        var newButtonSize = currentButtonSize + changeAmount;
        button.style.fontSize = newButtonSize + 'px';
    });

    // Adjust font size of select and option elements
    var select = document.getElementById('language');
    var options = select.querySelectorAll('option');
    select.style.fontSize = newSize + 'px'; // Apply the same font size as body to select element
    options.forEach(function(option) {
        option.style.fontSize = newSize + 'px'; // Apply the same font size as body to option elements
    });

    // Adjust font size of div elements
    var divs = document.querySelectorAll('div');
    divs.forEach(function(div) {
        var currentDivSize = parseFloat(window.getComputedStyle(div, null).getPropertyValue('font-size'));
        var newDivSize = currentDivSize + changeAmount;
        div.style.fontSize = newDivSize + 'px';
    });

    // Adjust font size of the microphone icon
    var microphoneIcon = document.querySelector('.mic-btn button i');
    var currentIconSize = parseFloat(window.getComputedStyle(microphoneIcon, null).getPropertyValue('font-size'));
    var newIconSize = currentIconSize + changeAmount;
    microphoneIcon.style.fontSize = newIconSize + 'px';
}


</script>
</body>
</html>